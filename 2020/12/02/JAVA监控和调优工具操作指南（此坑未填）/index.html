<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="JAVA,JVM,Thread,gc,Heap," />










<meta name="description" content="前言我们在日常的开发和维护工作中，免不了需要对JAVA程序进行监控、调优以及问题排查。 给一个系统定位问题的时候，知识、经验是关键基础，数据是依据，工具是运用知识处理数据的手段。这里说的数据包括∶运行日志、异常堆栈、GC日志、线程快照（thread dump&#x2F;java core文件）、堆转储快照（heap dump&#x2F;hprof文件）等。 经常使用适当的监控和分析工具可以加快我们分析数据、定位解决问">
<meta property="og:type" content="article">
<meta property="og:title" content="JAVA监控和调优工具操作指南">
<meta property="og:url" content="http://yoursite.com/2020/12/02/JAVA%E7%9B%91%E6%8E%A7%E5%92%8C%E8%B0%83%E4%BC%98%E5%B7%A5%E5%85%B7%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97%EF%BC%88%E6%AD%A4%E5%9D%91%E6%9C%AA%E5%A1%AB%EF%BC%89/index.html">
<meta property="og:site_name" content="cherish">
<meta property="og:description" content="前言我们在日常的开发和维护工作中，免不了需要对JAVA程序进行监控、调优以及问题排查。 给一个系统定位问题的时候，知识、经验是关键基础，数据是依据，工具是运用知识处理数据的手段。这里说的数据包括∶运行日志、异常堆栈、GC日志、线程快照（thread dump&#x2F;java core文件）、堆转储快照（heap dump&#x2F;hprof文件）等。 经常使用适当的监控和分析工具可以加快我们分析数据、定位解决问">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-3bcb4835de13ba36eadb8b19630a824973f.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-2c4c5b7173045d72f971624168e8cb70e73.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-16840d91b4bfcceb7cfb57aacb4b7f4e3b3.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-62cd627d9ee93c1fe76cb2474e5b75dbba4.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-a56eedc39b84a2f57451b3f7c5172fc7d32.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-7bf94c1599ea21d939c982c152f76125f6b.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-17e285a83ecb8b6d0aedd6efe5b5e3c91eb.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-3d8f5e1a88b7882699b13e00bf379611362.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-4ea5b8737fb9011c4030aa2c2d57e242811.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-9379bda74d5e129a548ffe7cfd724167ab1.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-adb15a8f73ef408099cbee2110bc9879f02.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-b79b41e6b74426fa258da530dcfd256847b.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-e4bb4b35ac7fed34239fc2785067e3e7574.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-35d57224bda3c1ce43daa4eed065ae0e0a2.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-f2d9d9dfa286b51df4e3575ae27423cd93e.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-992e8f7a9ced2b305f6a16d2184c77a5686.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-67f49e0ba5cdbfe3ac02c26aaa396f42648.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-4f07b6ea610226208c0791082ab70ce0689.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-2e60bd64a892a063c76037f7fbaa5ceb196.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-452f7c3598597bea5efd6a2596c52f13228.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-6c7772ec1a693d7702905d45950f2a661d0.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-c3cb2a0c165067a785f1e82eac8e86d5d6a.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-ba28e19bd75231959a868d3fa24644cb3ef.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-be84ee14d1f8990973fbfffa1f014827082.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-44a6d03fa59ee3d179a5352c3f8c17c15b7.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-fcb6eca9c1dd7c229a8833e66412f56fe94.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-b99529bc7810a586ef2d23f874cc9519a9f.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-e9c3e67acc4d4e817d3c206512b067d181e.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-918c3cea79f7a31ccdf12b7a0aa75eb461a.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-6fade6dd6c5d4c22ad5bc240c8b5f9d75e5.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-c7845203fa9fcefbe17a403fada331d2fe6.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-e4abad59b62e6227690f0b74c7e63636c9b.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-681a652365cd626166413836fac3559e3ae.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-88328e2da155165229e5fe23822dd977f76.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-c37f0628b26bad0a8400a13f7b86abe91f8.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-f5a52f0eee9f28932af48746f95e3223943.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-11772572f99a3f728e6ee1753fafbeea925.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-7b3aa6394fca39612e1e574d824e6362663.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-acd1b73254618670e43a14991798a3afeb7.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-3e498652fe610e4a921b1337f8fde118154.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-11dd1568537efa5bfb71e6327e5cd100ab4.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-1832aa910902ad945d0f4c6e7c009541567.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-6ee2e744430067f37f21fc733ed06c0d888.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-a46f88dfc8f4816f0c090b24eaa5aaef8d5.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-dbb2e524e7ef676a8b13536be297b1a1005.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-92d0c7e5219ec32ed45379a2fdea9f78785.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-25b65255824dc5691a94fa27cda8c66b382.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-22396788168496d5121b6acc394d3dbd1af.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-3552febc4e82aeb6dbd832dcaa723024e54.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-ffed656702f8fe2641cb4bb7ae83281b0ee.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-e38d18357d6c96ae69b4b9c25766b459c8b.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-7d9ad6266394309df4e9343655b7f1f6edd.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-718039e69ea0ad56e389bb512a81ff7ac48.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-03f1bfbcedf2a842dd3d0cb790b8d1287c6.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-8aa58a8dfaae014e7527a2014c165f8258c.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-80ed68d547848d4668aab24f61e7f44d698.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-69e8bee44a52630014339ec455772acf110.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-0a126964b1c68919ee1de1a4336be7e0aeb.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-e1185e4e6d8c2f03b51ebe8c0cc12795d79.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-d8aa6364c24d1ee6a5d54dca88e268b49e7.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-66d559639df230c6c48a70f8bd475f43d63.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-d1b4d0a420cce0835ec4eb2ad4ba03af88d.png">
<meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-5e0e8b3c2b4d94ca3a6b660f1defcec55d5.png">
<meta property="article:published_time" content="2020-12-02T12:39:02.000Z">
<meta property="article:modified_time" content="2020-12-02T14:34:48.420Z">
<meta property="article:author" content="cherish-ls">
<meta property="article:tag" content="JAVA">
<meta property="article:tag" content="JVM">
<meta property="article:tag" content="Thread">
<meta property="article:tag" content="gc">
<meta property="article:tag" content="Heap">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://oscimg.oschina.net/oscnet/up-3bcb4835de13ba36eadb8b19630a824973f.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/12/02/JAVA监控和调优工具操作指南（此坑未填）/"/>





  <title>JAVA监控和调优工具操作指南 | cherish</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">cherish</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">返朴归真</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Categories
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/12/02/JAVA%E7%9B%91%E6%8E%A7%E5%92%8C%E8%B0%83%E4%BC%98%E5%B7%A5%E5%85%B7%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97%EF%BC%88%E6%AD%A4%E5%9D%91%E6%9C%AA%E5%A1%AB%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="cherish-ls">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://oscimg.oschina.net/oscnet/up-c01f8b7b68770ed58c420d68072f773a30b.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="cherish">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">JAVA监控和调优工具操作指南</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-12-02T20:39:02+08:00">
                2020-12-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JAVA/JAVA%E7%9B%91%E6%8E%A7%E5%92%8C%E8%B0%83%E4%BC%98/" itemprop="url" rel="index">
                    <span itemprop="name">JAVA监控和调优</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/12/02/JAVA%E7%9B%91%E6%8E%A7%E5%92%8C%E8%B0%83%E4%BC%98%E5%B7%A5%E5%85%B7%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97%EF%BC%88%E6%AD%A4%E5%9D%91%E6%9C%AA%E5%A1%AB%EF%BC%89/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2020/12/02/JAVA监控和调优工具操作指南（此坑未填）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 浏览
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  11.2k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  47
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>我们在日常的开发和维护工作中，免不了需要对JAVA程序进行监控、调优以及问题排查。</p>
<p>给一个系统定位问题的时候，知识、经验是关键基础，数据是依据，工具是运用知识处理数据的手段。这里说的数据包括∶运行日志、异常堆栈、GC日志、线程快照（thread dump/java core文件）、堆转储快照（heap dump/hprof文件）等。</p>
<p>经常使用适当的监控和分析工具可以加快我们分析数据、定位解决问题的速度，但在学习工具前，也应当意识到工具永远都是知识技能的一层包装，没有什么工具是”秘密武器”，不可能学会了就能包治百病。</p>
<h2 id="进程id的获取"><a href="#进程id的获取" class="headerlink" title="进程id的获取"></a>进程id的获取</h2><p>许多工具或者命令需要用到java进程的进程id，有必要回顾一下。</p>
<blockquote>
<ol>
<li>查看当前运行的所有的java进程：<code>ps -ef|grep java</code>；</li>
<li>准确获取定位到tomcat下正在运行的java进程的PID命令：<code>ps -ef|grep java | grep catalina | awk &#39;{print $2}&#39;</code></li>
<li>准确定位到tomcat下正在运行的java进程相关信息：<code>ps -ef|grep java | grep catalina</code>.</li>
</ol>
</blockquote>
<h2 id="jinfo-jmap访问受限的解决"><a href="#jinfo-jmap访问受限的解决" class="headerlink" title="jinfo/jmap访问受限的解决"></a>jinfo/jmap访问受限的解决</h2><p>一般情况下，我们使用jinfo命令，可能会遇到如下的报错：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-3bcb4835de13ba36eadb8b19630a824973f.png" alt=""></p>
<p>这是因为新版的Linux系统加入了 ptrace-scope 机制,该机制的目的是防止用户访问正在执行的进程的内存，但是如jinfo,jmap这些调试类工具本身就是利用ptrace来获取执行进程的内存等信息。</p>
<p><strong>解决：</strong></p>
<ol>
<li>临时解决，该方法在下次重启前有效：<code>echo 0 | sudo tee /proc/sys/kernel/yama/ptrace_scope</code></li>
<li>永久解决，直接修改内核参数：<code>sudo vi /etc/sysctl.d/10-ptrace.conf</code><ul>
<li>编辑这行: <code>kernel.yama.ptrace_scope = 1</code></li>
<li>修改为: <code>kernel.yama.ptrace_scope = 0</code></li>
<li>重启系统，使修改生效。</li>
</ul>
</li>
</ol>
<blockquote>
<p>参数名：kernel.yama.ptrace_scope（值为１：表示禁止用户访问正在执行的进程的内存；０表示可以访问）</p>
</blockquote>
<h1 id="1-jps-显示JVM进程信息"><a href="#1-jps-显示JVM进程信息" class="headerlink" title="1 jps 显示JVM进程信息"></a>1 jps 显示JVM进程信息</h1><p>jps (Java Virtual Machine Process Status Tool)，是java提供的一个显示当前所有JAVA进程pid的命令，适合在linux/unix平台上简单察看当前java进程的一些简单情况。</p>
<p>我们常常会用到unix系统里的ps命令，这个命令主要是用来显示当前系统的进程情况，有哪些进程以及进程id。</p>
<p><strong>jps就是java程序版本的ps命令，它的作用是显示当前系统的java进程情况及进程id。</strong></p>
<p><strong>格式：<code>jps [-命令选项]</code></strong></p>
<p><img src="https://oscimg.oschina.net/oscnet/up-2c4c5b7173045d72f971624168e8cb70e73.png" alt=""></p>
<h2 id="1-1-jps的选项"><a href="#1-1-jps的选项" class="headerlink" title="1.1 jps的选项"></a>1.1 jps的选项</h2><p>jps默认只会打印进程id和java类名，如果要更具体的信息，则要借助更多的选项：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-16840d91b4bfcceb7cfb57aacb4b7f4e3b3.png" alt=""></p>
<ol>
<li><p>jps -q</p>
<ul>
<li>只显示pid，不显示class名称,jar文件名和传递给main方法的参数</li>
<li><img src="https://oscimg.oschina.net/oscnet/up-62cd627d9ee93c1fe76cb2474e5b75dbba4.png" alt=""></li>
</ul>
</li>
<li><p>jps -m</p>
<ul>
<li>输出传递给main方法的参数，在嵌入式jvm上可能是null</li>
<li><img src="https://oscimg.oschina.net/oscnet/up-a56eedc39b84a2f57451b3f7c5172fc7d32.png" alt=""></li>
</ul>
</li>
<li><p>jps -l</p>
<ul>
<li>输出应用程序main class的完整package名或者应用程序的jar文件完整路径名</li>
<li><img src="https://oscimg.oschina.net/oscnet/up-7bf94c1599ea21d939c982c152f76125f6b.png" alt=""></li>
</ul>
</li>
<li><p>jps -v</p>
<ul>
<li>输出传递给JVM的参数</li>
<li><img src="https://oscimg.oschina.net/oscnet/up-17e285a83ecb8b6d0aedd6efe5b5e3c91eb.png" alt=""></li>
</ul>
</li>
<li><p>jps -V</p>
<ul>
<li>隐藏输出传递给JVM的参数</li>
</ul>
</li>
</ol>
<h1 id="2-jinfo-显示JVM配置信息"><a href="#2-jinfo-显示JVM配置信息" class="headerlink" title="2 jinfo 显示JVM配置信息"></a>2 jinfo 显示JVM配置信息</h1><p>jinfo 是 JDK 自带的命令，可以用来查看正在运行的 java 应用程序的扩展参数，包括Java System属性和JVM命令行参数；也可以动态的修改正在运行的JVM一些参数。当系统崩溃时，jinfo也可以从core文件里面知道崩溃的Java应用程序的配置信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">    jinfo [option] &lt;pid&gt;</span><br><span class="line">        (to connect to running process)</span><br><span class="line">    jinfo [option] &lt;executable &lt;core&gt;</span><br><span class="line">        (to connect to a core file)</span><br><span class="line">    jinfo [option] [server_id@]&lt;remote server IP or hostname&gt;</span><br><span class="line">        (to connect to remote debug server)</span><br><span class="line"></span><br><span class="line">where &lt;option&gt; is one of:</span><br><span class="line">    -flag &lt;name&gt;         to print the value of the named VM flag</span><br><span class="line">    -flag [+|-]&lt;name&gt;    to enable or disable the named VM flag</span><br><span class="line">    -flag &lt;name&gt;&#x3D;&lt;value&gt; to set the named VM flag to the given value</span><br><span class="line">    -flags               to print VM flags</span><br><span class="line">    -sysprops            to print Java system properties</span><br><span class="line">    &lt;no option&gt;          to print both of the above</span><br><span class="line">    -h | -help           to print this help message</span><br></pre></td></tr></table></figure>

<p><strong>格式：<code>jinfo [-命令选项] &lt;pid&gt;</code> 或 <code>jinfo [-命令选项] &lt;executable core&gt;</code> 或 <code>jinfo [-命令选项] [server_id@] &lt;remote ip or hostname&gt;</code></strong></p>
<ul>
<li><code>pid</code>：对应jvm的进程id</li>
<li><code>executable core</code>：产生core dump文件</li>
<li><code>remote server IP or hostname</code>：远程调试服务的ip或者hostname</li>
<li><code>server-id</code>：唯一id,假如一台主机上多个远程debug服务;</li>
</ul>
<blockquote>
<p>Javacore，也可以称为“threaddump”或是“javadump”，它是 Java 提供的一种诊断特性，能够提供一份可读的当前运行的 JVM 中线程使用情况的快照。即在某个特定时刻，JVM 中有哪些线程在运行，每个线程执行到哪一个类，哪一个方法。<br>应用程序如果出现不可恢复的错误或是内存泄露，就会自动触发 Javacore 的生成。</p>
</blockquote>
<p>jinfo工具特别强大，有众多的可选命令选项，比如：</p>
<h2 id="2-1-输出JVM进程的参数和属性"><a href="#2-1-输出JVM进程的参数和属性" class="headerlink" title="2.1 输出JVM进程的参数和属性"></a>2.1 输出JVM进程的参数和属性</h2><p><code>jinfo &lt;pid&gt;</code></p>
<p>不带任何选项的情况下，输出当前 jvm 进程的全部参数和系统属性</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-3d8f5e1a88b7882699b13e00bf379611362.png" alt=""></p>
<h2 id="2-2-打印JVM特定参数的值"><a href="#2-2-打印JVM特定参数的值" class="headerlink" title="2.2 打印JVM特定参数的值"></a>2.2 打印JVM特定参数的值</h2><p><code>jinfo -flag &lt;name&gt; &lt;pid&gt;</code></p>
<p>用于打印虚拟机标记参数的值，name表示虚拟机标记参数的名称。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-4ea5b8737fb9011c4030aa2c2d57e242811.png" alt=""></p>
<h2 id="2-3-开启或关闭JVM特定参数"><a href="#2-3-开启或关闭JVM特定参数" class="headerlink" title="2.3 开启或关闭JVM特定参数"></a>2.3 开启或关闭JVM特定参数</h2><p><code>jinfo -flag [+|-]&lt;name&gt; &lt;pid&gt;</code></p>
<p>用于开启或关闭虚拟机标记参数。+表示开启，-表示关闭。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-9379bda74d5e129a548ffe7cfd724167ab1.png" alt=""></p>
<h2 id="2-4-设置JVM特定参数的值"><a href="#2-4-设置JVM特定参数的值" class="headerlink" title="2.4 设置JVM特定参数的值"></a>2.4 设置JVM特定参数的值</h2><p><code>jinfo -flag &lt;name&gt;=&lt;value&gt; &lt;pid&gt;</code></p>
<p>用于设置虚拟机标记参数，但并不是每个参数都可以被动态修改的。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-adb15a8f73ef408099cbee2110bc9879f02.png" alt=""></p>
<h2 id="2-5-打印所有JVM参数"><a href="#2-5-打印所有JVM参数" class="headerlink" title="2.5 打印所有JVM参数"></a>2.5 打印所有JVM参数</h2><p><code>jinfo -flags &lt;pid&gt;</code></p>
<p>打印虚拟机参数。什么是虚拟机参数呢？如<code>-XX:NewSize,-XX:OldSize</code>等就是虚拟机参数。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-b79b41e6b74426fa258da530dcfd256847b.png" alt=""></p>
<h2 id="2-6-打印所有系统参数"><a href="#2-6-打印所有系统参数" class="headerlink" title="2.6 打印所有系统参数"></a>2.6 打印所有系统参数</h2><p><code>jinfo -sysprops &lt;pid&gt;</code></p>
<p>打印所有系统参数</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-e4bb4b35ac7fed34239fc2785067e3e7574.png" alt=""></p>
<h1 id="3-jmap-生成内存快照文件"><a href="#3-jmap-生成内存快照文件" class="headerlink" title="3 jmap 生成内存快照文件"></a>3 jmap 生成内存快照文件</h1><p>jmap命令是一个可以输出所有内存中对象的工具，甚至可以将VM 中的heap，以二进制输出成文本。打印出某个java进程（使用pid）内存内的，所有‘对象’的情况（如：产生那些对象，及其数量）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">    jmap [option] &lt;pid&gt;</span><br><span class="line">        (to connect to running process)</span><br><span class="line">    jmap [option] &lt;executable &lt;core&gt;</span><br><span class="line">        (to connect to a core file)</span><br><span class="line">    jmap [option] [server_id@]&lt;remote server IP or hostname&gt;</span><br><span class="line">        (to connect to remote debug server)</span><br><span class="line"></span><br><span class="line">where &lt;option&gt; is one of:</span><br><span class="line">    &lt;none&gt;               to print same info as Solaris pmap</span><br><span class="line">    -heap                to print java heap summary</span><br><span class="line">    -histo[:live]        to print histogram of java object heap; if the &quot;live&quot;</span><br><span class="line">                         suboption is specified, only count live objects</span><br><span class="line">    -clstats             to print class loader statistics</span><br><span class="line">    -finalizerinfo       to print information on objects awaiting finalization</span><br><span class="line">    -dump:&lt;dump-options&gt; to dump java heap in hprof binary format</span><br><span class="line">                         dump-options:</span><br><span class="line">                           live         dump only live objects; if not specified,</span><br><span class="line">                                        all objects in the heap are dumped.</span><br><span class="line">                           format&#x3D;b     binary format</span><br><span class="line">                           file&#x3D;&lt;file&gt;  dump heap to &lt;file&gt;</span><br><span class="line">                         Example: jmap -dump:live,format&#x3D;b,file&#x3D;heap.bin &lt;pid&gt;</span><br><span class="line">    -F                   force. Use with -dump:&lt;dump-options&gt; &lt;pid&gt; or -histo</span><br><span class="line">                         to force a heap dump or histogram when &lt;pid&gt; does not</span><br><span class="line">                         respond. The &quot;live&quot; suboption is not supported</span><br><span class="line">                         in this mode.</span><br><span class="line">    -h | -help           to print this help message</span><br><span class="line">    -J&lt;flag&gt;             to pass &lt;flag&gt; directly to the runtime system</span><br></pre></td></tr></table></figure>

<p>64位机上使用需要使用如下方式：<code>jmap -J-d64 -heap pid</code></p>
<p><strong>格式：<code>jmap [option] &lt;pid&gt;</code> 或 <code>jmap [option] &lt;executable &lt;core&gt;</code> 或 <code>jmap [option] [server_id@]&lt;remote server IP or hostname&gt;</code></strong></p>
<ul>
<li><code>pid</code>：对应jvm的进程id</li>
<li><code>executable core</code>：产生core dump文件</li>
<li><code>remote server IP or hostname</code>：远程调试服务的ip或者hostname</li>
<li><code>server-id</code>：唯一id,假如一台主机上多个远程debug服务;</li>
</ul>
<p>jinfo工具特别强大，有众多的可选命令选项，比如：</p>
<h2 id="3-1-输出hprof二进制格式的heap文件"><a href="#3-1-输出hprof二进制格式的heap文件" class="headerlink" title="3.1 输出hprof二进制格式的heap文件"></a>3.1 输出hprof二进制格式的heap文件</h2><p><code>jmap -dump:live,format=b,file=myjmapfile.txt  &lt;pid&gt;</code><br>或<br><code>jmap -dump:file=myjmapfile.hprof,format=b &lt;pid&gt;</code></p>
<p>使用hprof二进制形式,输出jvm的heap内容到文件，file=可以指定文件存放的目录。live子选项是可选的，假如指定live选项，那么只输出活的对象到文件。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-35d57224bda3c1ce43daa4eed065ae0e0a2.png" alt=""></p>
<h2 id="3-2-打印正等候回收的对象的信息"><a href="#3-2-打印正等候回收的对象的信息" class="headerlink" title="3.2 打印正等候回收的对象的信息"></a>3.2 打印正等候回收的对象的信息</h2><p><code>jmap -finalizerinfo  &lt;pid&gt;</code></p>
<p>打印正等候回收的对象的信息。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-f2d9d9dfa286b51df4e3575ae27423cd93e.png" alt=""></p>
<p>Number of objects pending for finalization: 0 表示等候回收的对象为0个</p>
<h2 id="3-3-打印heap的概要信息"><a href="#3-3-打印heap的概要信息" class="headerlink" title="3.3 打印heap的概要信息"></a>3.3 打印heap的概要信息</h2><p><code>jmap -heap  &lt;pid&gt;</code></p>
<p>打印heap的概要信息，GC使用的算法，heap（堆）的配置及JVM堆内存的使用情况。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-992e8f7a9ced2b305f6a16d2184c77a5686.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Attaching to process ID 2805, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.181-b13</span><br><span class="line"></span><br><span class="line">using thread-local object allocation.</span><br><span class="line">Parallel GC with 4 thread(s)   ##GC 方式</span><br><span class="line"></span><br><span class="line">Heap Configuration:  ##堆配置情况，也就是JVM参数配置的结果[平常说的tomcat配置JVM参数，就是在配置这些]</span><br><span class="line">   MinHeapFreeRatio         &#x3D; 0  ##最小堆使用比例</span><br><span class="line">   MaxHeapFreeRatio         &#x3D; 100  ##最大堆可用比例</span><br><span class="line">   MaxHeapSize              &#x3D; 734003200 (700.0MB)  ##最大堆空间大小</span><br><span class="line">   NewSize                  &#x3D; 21495808 (20.5MB)  ##新生代分配大小</span><br><span class="line">   MaxNewSize               &#x3D; 244318208 (233.0MB)  ##最大可新生代分配大小</span><br><span class="line">   OldSize                  &#x3D; 43515904 (41.5MB)  ##老年代大小</span><br><span class="line">   NewRatio                 &#x3D; 2  ##新生代比例</span><br><span class="line">   SurvivorRatio            &#x3D; 8  ##新生代与suvivor的比例</span><br><span class="line">   MetaspaceSize            &#x3D; 21807104 (20.796875MB)  ## 元数据空间大小</span><br><span class="line">   CompressedClassSpaceSize &#x3D; 1073741824 (1024.0MB)  ## 压缩空间大小</span><br><span class="line">   MaxMetaspaceSize         &#x3D; 17592186044415 MB  ## 最大元数据空间大小</span><br><span class="line">   G1HeapRegionSize         &#x3D; 0 (0.0MB)  ## G1的对region空间大小</span><br><span class="line"></span><br><span class="line">Heap Usage:  ##堆使用情况【堆内存实际的使用情况】</span><br><span class="line">PS Young Generation  ##新生代（伊甸区Eden区 + 幸存区survior(1+2)空间）</span><br><span class="line">Eden Space:   ##伊甸区</span><br><span class="line">   capacity &#x3D; 32505856 (31.0MB)</span><br><span class="line">   used     &#x3D; 0 (0.0MB)</span><br><span class="line">   free     &#x3D; 32505856 (31.0MB)</span><br><span class="line">   0.0% used</span><br><span class="line">From Space:  ##survior1区</span><br><span class="line">   capacity &#x3D; 2621440 (2.5MB)</span><br><span class="line">   used     &#x3D; 0 (0.0MB)</span><br><span class="line">   free     &#x3D; 2621440 (2.5MB)</span><br><span class="line">   0.0% used</span><br><span class="line">To Space:  ##survior2 区</span><br><span class="line">   capacity &#x3D; 4194304 (4.0MB)</span><br><span class="line">   used     &#x3D; 0 (0.0MB)</span><br><span class="line">   free     &#x3D; 4194304 (4.0MB)</span><br><span class="line">   0.0% used</span><br><span class="line">PS Old Generation  ##老年代使用情况</span><br><span class="line">   capacity &#x3D; 21495808 (20.5MB)</span><br><span class="line">   used     &#x3D; 3738528 (3.565338134765625MB)</span><br><span class="line">   free     &#x3D; 17757280 (16.934661865234375MB)</span><br><span class="line">   17.391893340320124% used</span><br><span class="line"></span><br><span class="line">4524 interned Strings occupying 360168 bytes.</span><br></pre></td></tr></table></figure>

<h2 id="3-4-打印每个class的实例信息"><a href="#3-4-打印每个class的实例信息" class="headerlink" title="3.4 打印每个class的实例信息"></a>3.4 打印每个class的实例信息</h2><p><code>jmap -histo:live &lt;pid&gt;</code><br>或<br><code>jmap -histo: &lt;pid&gt;</code></p>
<p>打印每个class的实例数目，内存占用,类全名信息，VM的内部类名字开头会加上前缀”*”。如果live子参数加上后，只统计活的对象数量</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-67f49e0ba5cdbfe3ac02c26aaa396f42648.png" alt=""></p>
<blockquote>
<p>采用jmap -histo pid&gt;a.log日志将其保存，在一段时间后，使用文本对比工具，可以对比出GC回收了哪些对象。</p>
</blockquote>
<blockquote>
<p>jmap -dump:format=b,file=outfile 3024可以将3024进程的内存heap输出出来到outfile文件里，再配合MAT（内存分析工具）。</p>
</blockquote>
<h2 id="3-5-打印类加载器的数据"><a href="#3-5-打印类加载器的数据" class="headerlink" title="3.5 打印类加载器的数据"></a>3.5 打印类加载器的数据</h2><p><code>jmap -clstats &lt;pid&gt;</code></p>
<p>-clstats是-permstat的替代方案，在JDK8之前，-permstat用来打印类加载器的数据。打印Java堆内存的永久保存区域的类加载器的智能统计信息。</p>
<p>对于每个类加载器而言，它的名称、活跃度、地址、父类加载器、它所加载的类的数量和大小都会被打印。此外，包含的字符串数量和大小也会被打印。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-4f07b6ea610226208c0791082ab70ce0689.png" alt=""></p>
<h2 id="3-6-指定传递给运行jmap的JVM的参数"><a href="#3-6-指定传递给运行jmap的JVM的参数" class="headerlink" title="3.6 指定传递给运行jmap的JVM的参数"></a>3.6 指定传递给运行jmap的JVM的参数</h2><p><code>jmap -J&lt;flag&gt; &lt;pid&gt;</code></p>
<p>指定传递给运行jmap的JVM的参数</p>
<p>如<code>jmap -J-d64 -heap pid</code>表示在64位机上使用<code>jmap -heap</code></p>
<h1 id="4-jstack-输出线程堆栈快照"><a href="#4-jstack-输出线程堆栈快照" class="headerlink" title="4 jstack 输出线程堆栈快照"></a>4 jstack 输出线程堆栈快照</h1><p>jstack用于打印出给定的java进程ID或core file或远程调试服务的Java堆栈信息（也就是线程），如果是在64位机器上，需要指定选项”-J-d64”，Windows的jstack使用方式只支持以下的这种方式：<code>jstack [-l] pid</code></p>
<p>如果java程序崩溃生成core文件，jstack工具可以用来获得core文件的java stack和native stack的信息，从而可以轻松地知道java程序是如何崩溃和在程序何处发生问题。</p>
<p>另外，jstack工具还可以附属到正在运行的java程序中，看到当时运行的java程序的java stack和native stack的信息，如果现在运行的java程序呈现hung的状态，jstack是非常有用的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Usage:</span><br><span class="line">    jstack [-l] &lt;pid&gt;</span><br><span class="line">        (to connect to running process)</span><br><span class="line">    jstack -F [-m] [-l] &lt;pid&gt;</span><br><span class="line">        (to connect to a hung process)</span><br><span class="line">    jstack [-m] [-l] &lt;executable&gt; &lt;core&gt;</span><br><span class="line">        (to connect to a core file)</span><br><span class="line">    jstack [-m] [-l] [server_id@]&lt;remote server IP or hostname&gt;</span><br><span class="line">        (to connect to a remote debug server)</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">    -F  to force a thread dump. Use when jstack &lt;pid&gt; does not respond (process is hung)</span><br><span class="line">    -m  to print both java and native frames (mixed mode)</span><br><span class="line">    -l  long listing. Prints additional information about locks</span><br><span class="line">    -h or -help to print this help message</span><br></pre></td></tr></table></figure>

<p><strong>格式：<code>jstack [option] &lt;pid&gt;</code> 或 <code>jstack [option] &lt;executable &lt;core&gt;</code> 或 <code>jstack [option] [server_id@]&lt;remote server IP or hostname&gt;</code></strong></p>
<ul>
<li><code>pid</code>：对应jvm的进程id</li>
<li><code>executable core</code>：产生core dump文件</li>
<li><code>remote server IP or hostname</code>：远程调试服务的ip或者hostname</li>
<li><code>server-id</code>：唯一id,假如一台主机上多个远程debug服务;</li>
</ul>
<p>jstack工具特别强大，有众多的可选命令选项和适用场景，比如：</p>
<h2 id="4-1-程序没有响应时强制打印线程"><a href="#4-1-程序没有响应时强制打印线程" class="headerlink" title="4.1 程序没有响应时强制打印线程"></a>4.1 程序没有响应时强制打印线程</h2><p><code>jstack -F &lt;pid&gt;</code></p>
<p>当pid对应的程序没有响应时，强制打印线程堆栈信息。</p>
<h2 id="4-2-打印完整的堆栈信息"><a href="#4-2-打印完整的堆栈信息" class="headerlink" title="4.2 打印完整的堆栈信息"></a>4.2 打印完整的堆栈信息</h2><p><code>jstack -l &lt;pid&gt;</code></p>
<p>长列表，打印关于锁的附加信息，例如属于java.util.concurrent的ownable synchronizers列表。</p>
<h2 id="4-3-打印java-native框架的所有堆栈"><a href="#4-3-打印java-native框架的所有堆栈" class="headerlink" title="4.3 打印java/native框架的所有堆栈"></a>4.3 打印java/native框架的所有堆栈</h2><p><code>jstack -m &lt;pid&gt;</code></p>
<p>打印java和native c/c++框架的所有栈信息。</p>
<h2 id="4-4-jstack统计线程数"><a href="#4-4-jstack统计线程数" class="headerlink" title="4.4 jstack统计线程数"></a>4.4 jstack统计线程数</h2><p><code>jstack -l 28367 | grep &#39;java.lang.Thread.State&#39; | wc -l</code></p>
<h2 id="4-5-jstack检测死锁"><a href="#4-5-jstack检测死锁" class="headerlink" title="4.5 jstack检测死锁"></a>4.5 jstack检测死锁</h2><p>我们先写个死锁代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public class DeathLock &#123;</span><br><span class="line"></span><br><span class="line">    private static Lock lock1 &#x3D; new ReentrantLock();</span><br><span class="line">    private static Lock lock2 &#x3D; new ReentrantLock();</span><br><span class="line"></span><br><span class="line">    public static void deathLock() &#123;</span><br><span class="line">        Thread t1 &#x3D; new Thread() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    lock1.lock();</span><br><span class="line">                    TimeUnit.SECONDS.sleep(1);</span><br><span class="line">                    lock2.lock();</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Thread t2 &#x3D; new Thread() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    lock2.lock();</span><br><span class="line">                    TimeUnit.SECONDS.sleep(1);</span><br><span class="line">                    lock1.lock();</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        t1.setName(&quot;mythread1&quot;);</span><br><span class="line">        t2.setName(&quot;mythread2&quot;);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        deathLock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个死锁会输出如下日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">&quot;mythread2&quot; #12 prio&#x3D;5 os_prio&#x3D;0 tid&#x3D;0x0000000058ef7800 nid&#x3D;0x1ab4 waiting on condition [0x0000000059f8f000]</span><br><span class="line">   java.lang.Thread.State: WAITING (parking)</span><br><span class="line">        at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">        - parking to wait for  &lt;0x00000000d602d610&gt; (a java.util.concurrent.lock</span><br><span class="line">s.ReentrantLock$NonfairSync)</span><br><span class="line">        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)</span><br><span class="line">        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInt</span><br><span class="line">errupt(AbstractQueuedSynchronizer.java:836)</span><br><span class="line">        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(A</span><br><span class="line">bstractQueuedSynchronizer.java:870)</span><br><span class="line">        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(Abstrac</span><br><span class="line">tQueuedSynchronizer.java:1199)</span><br><span class="line">        at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLo</span><br><span class="line">ck.java:209)</span><br><span class="line">        at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:285)</span><br><span class="line"></span><br><span class="line">        at DeathLock$2.run(DeathLock.java:34)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - &lt;0x00000000d602d640&gt; (a java.util.concurrent.locks.ReentrantLock$Nonfa</span><br><span class="line">irSync)</span><br><span class="line"></span><br><span class="line">&quot;mythread1&quot; #11 prio&#x3D;5 os_prio&#x3D;0 tid&#x3D;0x0000000058ef7000 nid&#x3D;0x3e68 waiting on condition [0x000000005947f000]</span><br><span class="line">   java.lang.Thread.State: WAITING (parking)</span><br><span class="line">        at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">        - parking to wait for  &lt;0x00000000d602d640&gt; (a java.util.concurrent.lock</span><br><span class="line">s.ReentrantLock$NonfairSync)</span><br><span class="line">        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)</span><br><span class="line">        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInt</span><br><span class="line">errupt(AbstractQueuedSynchronizer.java:836)</span><br><span class="line">        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(A</span><br><span class="line">bstractQueuedSynchronizer.java:870)</span><br><span class="line">        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(Abstrac</span><br><span class="line">tQueuedSynchronizer.java:1199)</span><br><span class="line">        at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLo</span><br><span class="line">ck.java:209)</span><br><span class="line">        at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:285)</span><br><span class="line"></span><br><span class="line">        at DeathLock$1.run(DeathLock.java:22)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - &lt;0x00000000d602d610&gt; (a java.util.concurrent.locks.ReentrantLock$Nonfa</span><br><span class="line">irSync)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Found one Java-level deadlock:</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&quot;mythread2&quot;:</span><br><span class="line">  waiting for ownable synchronizer 0x00000000d602d610, (a java.util.concurrent.l</span><br><span class="line">ocks.ReentrantLock$NonfairSync),</span><br><span class="line">  which is held by &quot;mythread1&quot;</span><br><span class="line">&quot;mythread1&quot;:</span><br><span class="line">  waiting for ownable synchronizer 0x00000000d602d640, (a java.util.concurrent.l</span><br><span class="line">ocks.ReentrantLock$NonfairSync),</span><br><span class="line">  which is held by &quot;mythread2&quot;</span><br><span class="line"></span><br><span class="line">Java stack information for the threads listed above:</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&quot;mythread2&quot;:</span><br><span class="line">        at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">        - parking to wait for  &lt;0x00000000d602d610&gt; (a java.util.concurrent.lock</span><br><span class="line">s.ReentrantLock$NonfairSync)</span><br><span class="line">        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)</span><br><span class="line">        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInt</span><br><span class="line">errupt(AbstractQueuedSynchronizer.java:836)</span><br><span class="line">        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(A</span><br><span class="line">bstractQueuedSynchronizer.java:870)</span><br><span class="line">        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(Abstrac</span><br><span class="line">tQueuedSynchronizer.java:1199)</span><br><span class="line">        at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLo</span><br><span class="line">ck.java:209)</span><br><span class="line">        at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:285)</span><br><span class="line"></span><br><span class="line">        at DeathLock$2.run(DeathLock.java:34)</span><br><span class="line">&quot;mythread1&quot;:</span><br><span class="line">        at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">        - parking to wait for  &lt;0x00000000d602d640&gt; (a java.util.concurrent.lock</span><br><span class="line">s.ReentrantLock$NonfairSync)</span><br><span class="line">        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)</span><br><span class="line">        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInt</span><br><span class="line">errupt(AbstractQueuedSynchronizer.java:836)</span><br><span class="line">        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(A</span><br><span class="line">bstractQueuedSynchronizer.java:870)</span><br><span class="line">        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(Abstrac</span><br><span class="line">tQueuedSynchronizer.java:1199)</span><br><span class="line">        at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLo</span><br><span class="line">ck.java:209)</span><br><span class="line">        at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:285)</span><br><span class="line"></span><br><span class="line">        at DeathLock$1.run(DeathLock.java:22)</span><br><span class="line"></span><br><span class="line">Found 1 deadlock.</span><br></pre></td></tr></table></figure>


<h2 id="4-6-jstack检测cpu高"><a href="#4-6-jstack检测cpu高" class="headerlink" title="4.6 jstack检测cpu高"></a>4.6 jstack检测cpu高</h2><p><strong>步骤一：查看cpu占用高进程</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; top</span><br><span class="line"></span><br><span class="line">Mem:  16333644k total,  9472968k used,  6860676k free,   165616k buffers</span><br><span class="line">Swap:        0k total,        0k used,        0k free,  6665292k cached</span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND</span><br><span class="line">17850 root      20   0 7588m 112m  11m S 100.7  0.7  47:53.80 java</span><br><span class="line"> 1552 root      20   0  121m  13m 8524 S  0.7  0.1  14:37.75 AliYunDun</span><br><span class="line"> 3581 root      20   0 9750m 2.0g  13m S  0.7 12.9 298:30.20 java</span><br><span class="line">    1 root      20   0 19360 1612 1308 S  0.0  0.0   0:00.81 init</span><br><span class="line">    2 root      20   0     0    0    0 S  0.0  0.0   0:00.00 kthreadd</span><br><span class="line">    3 root      RT   0     0    0    0 S  0.0  0.0   0:00.14 migration&#x2F;0</span><br></pre></td></tr></table></figure>

<p><strong>步骤二：查看cpu占用高线程</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; top -H -p 17850</span><br><span class="line"></span><br><span class="line">top - 17:43:15 up 5 days,  7:31,  1 user,  load average: 0.99, 0.97, 0.91</span><br><span class="line">Tasks:  32 total,   1 running,  31 sleeping,   0 stopped,   0 zombie</span><br><span class="line">Cpu(s):  3.7%us,  8.9%sy,  0.0%ni, 87.4%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st</span><br><span class="line">Mem:  16333644k total,  9592504k used,  6741140k free,   165700k buffers</span><br><span class="line">Swap:        0k total,        0k used,        0k free,  6781620k cached</span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND</span><br><span class="line">17880 root      20   0 7588m 112m  11m R 99.9  0.7  50:47.43 java</span><br><span class="line">17856 root      20   0 7588m 112m  11m S  0.3  0.7   0:02.08 java</span><br><span class="line">17850 root      20   0 7588m 112m  11m S  0.0  0.7   0:00.00 java</span><br><span class="line">17851 root      20   0 7588m 112m  11m S  0.0  0.7   0:00.23 java</span><br><span class="line">17852 root      20   0 7588m 112m  11m S  0.0  0.7   0:02.09 java</span><br><span class="line">17853 root      20   0 7588m 112m  11m S  0.0  0.7   0:02.12 java</span><br><span class="line">17854 root      20   0 7588m 112m  11m S  0.0  0.7   0:02.07 java</span><br></pre></td></tr></table></figure>

<p><strong>步骤三：转换线程ID</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; printf &quot;%x\n&quot; 17880</span><br><span class="line">45d8</span><br></pre></td></tr></table></figure>

<p><strong>步骤四：定位cpu占用线程</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">jstack 17850|grep 45d8 -A 30</span><br><span class="line">&quot;pool-1-thread-11&quot; #20 prio&#x3D;5 os_prio&#x3D;0 tid&#x3D;0x00007fc860352800 nid&#x3D;0x45d8 runnable [0x00007fc8417d2000]</span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">        at java.io.FileOutputStream.writeBytes(Native Method)</span><br><span class="line">        at java.io.FileOutputStream.write(FileOutputStream.java:326)</span><br><span class="line">        at java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:82)</span><br><span class="line">        at java.io.BufferedOutputStream.flush(BufferedOutputStream.java:140)</span><br><span class="line">        - locked &lt;0x00000006c6c2e708&gt; (a java.io.BufferedOutputStream)</span><br><span class="line">        at java.io.PrintStream.write(PrintStream.java:482)</span><br><span class="line">        - locked &lt;0x00000006c6c10178&gt; (a java.io.PrintStream)</span><br><span class="line">        at sun.nio.cs.StreamEncoder.writeBytes(StreamEncoder.java:221)</span><br><span class="line">        at sun.nio.cs.StreamEncoder.implFlushBuffer(StreamEncoder.java:291)</span><br><span class="line">        at sun.nio.cs.StreamEncoder.flushBuffer(StreamEncoder.java:104)</span><br><span class="line">        - locked &lt;0x00000006c6c26620&gt; (a java.io.OutputStreamWriter)</span><br><span class="line">        at java.io.OutputStreamWriter.flushBuffer(OutputStreamWriter.java:185)</span><br><span class="line">        at java.io.PrintStream.write(PrintStream.java:527)</span><br><span class="line">        - eliminated &lt;0x00000006c6c10178&gt; (a java.io.PrintStream)</span><br><span class="line">        at java.io.PrintStream.print(PrintStream.java:597)</span><br><span class="line">        at java.io.PrintStream.println(PrintStream.java:736)</span><br><span class="line">        - locked &lt;0x00000006c6c10178&gt; (a java.io.PrintStream)</span><br><span class="line">        at com.demo.guava.HardTask.call(HardTask.java:18)</span><br><span class="line">        at com.demo.guava.HardTask.call(HardTask.java:9)</span><br><span class="line">        at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:745)</span><br><span class="line"></span><br><span class="line">&quot;pool-1-thread-10&quot; #19 prio&#x3D;5 os_prio&#x3D;0 tid&#x3D;0x00007fc860345000 nid&#x3D;0x45d7 waiting on condition [0x00007fc8418d3000]</span><br><span class="line">   java.lang.Thread.State: WAITING (parking)</span><br><span class="line">        at sun.misc.Unsafe.park(Native Method)</span><br><span class="line">        - parking to wait for  &lt;0x00000006c6c14178&gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)</span><br><span class="line">        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)</span><br></pre></td></tr></table></figure>


<h1 id="5-jstat-收集JVM运行数据"><a href="#5-jstat-收集JVM运行数据" class="headerlink" title="5 jstat 收集JVM运行数据"></a>5 jstat 收集JVM运行数据</h1><p>Jstat是JDK自带的一个轻量级小工具。全称“Java Virtual Machine statistics monitoring tool”，它位于java的bin目录下，主要利用JVM内建的指令对Java应用程序的资源和性能进行实时的命令行的监控，包括了堆内存各部分的使用量，以及加载类的数量，还有垃圾回收状况的监控。</p>
<p>可见，Jstat是轻量级的、专门针对JVM的工具。</p>
<p><strong>格式：<code>jstat [-命令选项] &lt;pid&gt;</code></strong></p>
<p>jstat工具特别强大，有众多的可选项，详细查看堆内各个部分的使用量，以及加载类的数量。使用时，需加上查看进程的进程id，和所选参数。参考格式如下：</p>
<h2 id="5-1-类加载统计"><a href="#5-1-类加载统计" class="headerlink" title="5.1 类加载统计"></a>5.1 类加载统计</h2><p><code>jstat –class &lt;pid&gt;</code></p>
<p>显示加载class的数量，及所占空间等信息。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-2e60bd64a892a063c76037f7fbaa5ceb196.png" alt=""></p>
<table>
<thead>
<tr>
<th>显示列名</th>
<th>具体描述</th>
</tr>
</thead>
<tbody><tr>
<td>Loaded</td>
<td>装载的类的数量</td>
</tr>
<tr>
<td>Bytes</td>
<td>装载类所占用的字节数</td>
</tr>
<tr>
<td>Unloaded</td>
<td>卸载类的数量</td>
</tr>
<tr>
<td>Bytes</td>
<td>卸载类的字节数</td>
</tr>
<tr>
<td>Time</td>
<td>装载和卸载类所花费的时间</td>
</tr>
</tbody></table>
<h2 id="5-2-编译统计"><a href="#5-2-编译统计" class="headerlink" title="5.2 编译统计"></a>5.2 编译统计</h2><p><code>jstat -compiler &lt;pid&gt;</code></p>
<p>显示VM实时编译的数量等信息。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-452f7c3598597bea5efd6a2596c52f13228.png" alt=""></p>
<table>
<thead>
<tr>
<th>显示列名</th>
<th>具体描述</th>
</tr>
</thead>
<tbody><tr>
<td>Compiled</td>
<td>编译任务执行数量</td>
</tr>
<tr>
<td>Failed</td>
<td>编译任务执行失败数量</td>
</tr>
<tr>
<td>Invalid</td>
<td>编译任务执行失效数量</td>
</tr>
<tr>
<td>Time</td>
<td>编译任务消耗时间</td>
</tr>
<tr>
<td>FailedType</td>
<td>最后一个编译失败任务的类型</td>
</tr>
<tr>
<td>FailedMethod</td>
<td>最后一个编译失败任务所在的类及方法</td>
</tr>
</tbody></table>
<h2 id="5-3-垃圾回收统计"><a href="#5-3-垃圾回收统计" class="headerlink" title="5.3 垃圾回收统计"></a>5.3 垃圾回收统计</h2><p><code>jstat -gc &lt;pid&gt;</code></p>
<p>显示gc的信息，查看gc的次数，及时间。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-6c7772ec1a693d7702905d45950f2a661d0.png" alt=""></p>
<table>
<thead>
<tr>
<th>显示列名</th>
<th>具体描述</th>
</tr>
</thead>
<tbody><tr>
<td>S0C</td>
<td>年轻代中第一个survivor（幸存区）的容量 (字节)</td>
</tr>
<tr>
<td>S1C</td>
<td>年轻代中第二个survivor（幸存区）的容量 (字节)</td>
</tr>
<tr>
<td>S0U</td>
<td>年轻代中第一个survivor（幸存区）目前已使用空间 (字节)</td>
</tr>
<tr>
<td>S1U</td>
<td>年轻代中第二个survivor（幸存区）目前已使用空间 (字节)</td>
</tr>
<tr>
<td>EC</td>
<td>年轻代中Eden（伊甸区）的容量 (字节)</td>
</tr>
<tr>
<td>EU</td>
<td>年轻代中Eden（伊甸区）目前已使用空间 (字节)</td>
</tr>
<tr>
<td>OC</td>
<td>Old代的容量 (字节)</td>
</tr>
<tr>
<td>OU</td>
<td>Old代目前已使用空间 (字节)</td>
</tr>
<tr>
<td>PC</td>
<td>Perm(持久代)的容量 (字节)</td>
</tr>
<tr>
<td>PU</td>
<td>Perm(持久代)目前已使用空间 (字节)</td>
</tr>
<tr>
<td>YGC</td>
<td>从应用程序启动到采样时年轻代中gc次数</td>
</tr>
<tr>
<td>YGCT</td>
<td>从应用程序启动到采样时年轻代中gc所用时间(s)</td>
</tr>
<tr>
<td>FGC</td>
<td>从应用程序启动到采样时old代(full gc)gc次数</td>
</tr>
<tr>
<td>FGCT</td>
<td>从应用程序启动到采样时old代(full gc)gc所用时间(s)</td>
</tr>
<tr>
<td>GCT</td>
<td>从应用程序启动到采样时gc用的总时间(s)</td>
</tr>
</tbody></table>
<h2 id="5-4-堆内存统计"><a href="#5-4-堆内存统计" class="headerlink" title="5.4 堆内存统计"></a>5.4 堆内存统计</h2><p><code>jstat -gccapacity &lt;pid&gt;</code></p>
<p>显示VM内存中三代（young，old，perm）对象的使用和占用大小</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-c3cb2a0c165067a785f1e82eac8e86d5d6a.png" alt=""></p>
<table>
<thead>
<tr>
<th>显示列名</th>
<th>具体描述</th>
</tr>
</thead>
<tbody><tr>
<td>NGCMN</td>
<td>年轻代(young)中初始化(最小)的大小(字节)</td>
</tr>
<tr>
<td>NGCMX</td>
<td>年轻代(young)的最大容量 (字节)</td>
</tr>
<tr>
<td>NGC</td>
<td>年轻代(young)中当前的容量 (字节)</td>
</tr>
<tr>
<td>S0C</td>
<td>年轻代中第一个survivor（幸存区）的容量 (字节)</td>
</tr>
<tr>
<td>S1C</td>
<td>年轻代中第二个survivor（幸存区）的容量 (字节)</td>
</tr>
<tr>
<td>EC</td>
<td>年轻代中Eden（伊甸区）的容量 (字节)</td>
</tr>
<tr>
<td>OGCMN</td>
<td>old代中初始化(最小)的大小 (字节)</td>
</tr>
<tr>
<td>OGCMX</td>
<td>old代的最大容量(字节)</td>
</tr>
<tr>
<td>OGC</td>
<td>old代当前新生成的容量 (字节)</td>
</tr>
<tr>
<td>OC</td>
<td>old代的容量 (字节)</td>
</tr>
<tr>
<td>PGCMN</td>
<td>perm代中初始化(最小)的大小 (字节)</td>
</tr>
<tr>
<td>PGCMX</td>
<td>perm代的最大容量 (字节)</td>
</tr>
<tr>
<td>PGC</td>
<td>perm代当前新生成的容量 (字节)</td>
</tr>
<tr>
<td>PC</td>
<td>Perm(持久代)的容量 (字节)</td>
</tr>
<tr>
<td>YGC</td>
<td>从应用程序启动到采样时年轻代中gc次数</td>
</tr>
<tr>
<td>FGC</td>
<td>从应用程序启动到采样时old代(full gc)gc次数</td>
</tr>
</tbody></table>
<h2 id="5-5-新生代垃圾回收统计"><a href="#5-5-新生代垃圾回收统计" class="headerlink" title="5.5 新生代垃圾回收统计"></a>5.5 新生代垃圾回收统计</h2><p><code>jstat -gcnew &lt;pid&gt;</code></p>
<p>统计年轻代对象的信息</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-ba28e19bd75231959a868d3fa24644cb3ef.png" alt=""></p>
<table>
<thead>
<tr>
<th>显示列名</th>
<th>具体描述</th>
</tr>
</thead>
<tbody><tr>
<td>S0C</td>
<td>年轻代中第一个survivor（幸存区）的容量 (字节)</td>
</tr>
<tr>
<td>S1C</td>
<td>年轻代中第二个survivor（幸存区）的容量 (字节)</td>
</tr>
<tr>
<td>S0U</td>
<td>年轻代中第一个survivor（幸存区）目前已使用空间 (字节)</td>
</tr>
<tr>
<td>S1U</td>
<td>年轻代中第二个survivor（幸存区）目前已使用空间 (字节)</td>
</tr>
<tr>
<td>TT</td>
<td>持有次数限制</td>
</tr>
<tr>
<td>MTT</td>
<td>最大持有次数限制</td>
</tr>
<tr>
<td>DSS</td>
<td>期望的幸存区大小</td>
</tr>
<tr>
<td>EC</td>
<td>年轻代中Eden（伊甸区）的容量 (字节)</td>
</tr>
<tr>
<td>EU</td>
<td>年轻代中Eden（伊甸区）目前已使用空间 (字节)</td>
</tr>
<tr>
<td>YGC</td>
<td>从应用程序启动到采样时年轻代中gc次数</td>
</tr>
<tr>
<td>YGCT</td>
<td>从应用程序启动到采样时年轻代中gc所用时间(s)</td>
</tr>
</tbody></table>
<h2 id="5-6-新生代内存统计"><a href="#5-6-新生代内存统计" class="headerlink" title="5.6 新生代内存统计"></a>5.6 新生代内存统计</h2><p><code>jstat -gcnewcapacity &lt;pid&gt;</code></p>
<p>统计年轻代对象的信息及其占用量。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-be84ee14d1f8990973fbfffa1f014827082.png" alt=""></p>
<table>
<thead>
<tr>
<th>显示列名</th>
<th>具体描述</th>
</tr>
</thead>
<tbody><tr>
<td>NGCMN</td>
<td>年轻代(young)中初始化(最小)的大小(字节)</td>
</tr>
<tr>
<td>NGCMX</td>
<td>年轻代(young)的最大容量 (字节)</td>
</tr>
<tr>
<td>NGC</td>
<td>年轻代(young)中当前的容量 (字节)</td>
</tr>
<tr>
<td>S0CMX</td>
<td>年轻代中第一个survivor（幸存区）的最大容量 (字节)</td>
</tr>
<tr>
<td>S0C</td>
<td>年轻代中第一个survivor（幸存区）的容量 (字节)</td>
</tr>
<tr>
<td>S1CMX</td>
<td>年轻代中第二个survivor（幸存区）的最大容量 (字节)</td>
</tr>
<tr>
<td>S1C</td>
<td>年轻代中第二个survivor（幸存区）的容量 (字节)</td>
</tr>
<tr>
<td>ECMX</td>
<td>年轻代中Eden（伊甸区）的最大容量 (字节)</td>
</tr>
<tr>
<td>EC</td>
<td>年轻代中Eden（伊甸区）的容量 (字节)</td>
</tr>
<tr>
<td>YGC</td>
<td>从应用程序启动到采样时年轻代中gc次数</td>
</tr>
<tr>
<td>FGC</td>
<td>从应用程序启动到采样时old代(full gc)gc次数</td>
</tr>
</tbody></table>
<h2 id="5-7-老年代垃圾回收统计"><a href="#5-7-老年代垃圾回收统计" class="headerlink" title="5.7 老年代垃圾回收统计"></a>5.7 老年代垃圾回收统计</h2><p><code>jstat -gcold &lt;pid&gt;</code></p>
<p>统计老年代对象的信息</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-44a6d03fa59ee3d179a5352c3f8c17c15b7.png" alt=""></p>
<table>
<thead>
<tr>
<th>显示列名</th>
<th>具体描述</th>
</tr>
</thead>
<tbody><tr>
<td>MC</td>
<td>方法区大小</td>
</tr>
<tr>
<td>MU</td>
<td>方法区使用大小</td>
</tr>
<tr>
<td>CCSC</td>
<td>压缩类空间大小</td>
</tr>
<tr>
<td>CCSU</td>
<td>压缩类空间使用大小</td>
</tr>
<tr>
<td>OC</td>
<td>Old代的容量 (字节)</td>
</tr>
<tr>
<td>OU</td>
<td>Old代目前已使用空间 (字节)</td>
</tr>
<tr>
<td>YGC</td>
<td>从应用程序启动到采样时年轻代中gc次数</td>
</tr>
<tr>
<td>FGC</td>
<td>从应用程序启动到采样时old代(full gc)gc次数</td>
</tr>
<tr>
<td>YGCT</td>
<td>从应用程序启动到采样时年轻代中gc所用时间(s)</td>
</tr>
<tr>
<td>GCT</td>
<td>从应用程序启动到采样时gc用的总时间(s)</td>
</tr>
</tbody></table>
<h2 id="5-8-老年代内存统计"><a href="#5-8-老年代内存统计" class="headerlink" title="5.8 老年代内存统计"></a>5.8 老年代内存统计</h2><p><code>jstat -gcoldcapacity &lt;pid&gt;</code></p>
<p>统计老年代对象的信息及其占用量</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-fcb6eca9c1dd7c229a8833e66412f56fe94.png" alt=""></p>
<table>
<thead>
<tr>
<th>显示列名</th>
<th>具体描述</th>
</tr>
</thead>
<tbody><tr>
<td>OGCMN</td>
<td>old代中初始化(最小)的大小 (字节)</td>
</tr>
<tr>
<td>OGCMX</td>
<td>old代的最大容量(字节)</td>
</tr>
<tr>
<td>OGC</td>
<td>old代当前新生成的容量 (字节)</td>
</tr>
<tr>
<td>OC</td>
<td>Old代的容量 (字节)</td>
</tr>
<tr>
<td>YGC</td>
<td>从应用程序启动到采样时年轻代中gc次数</td>
</tr>
<tr>
<td>FGC</td>
<td>从应用程序启动到采样时old代(full gc)gc次数</td>
</tr>
<tr>
<td>YGCT</td>
<td>从应用程序启动到采样时年轻代中gc所用时间(s)</td>
</tr>
<tr>
<td>GCT</td>
<td>从应用程序启动到采样时gc用的总时间(s)</td>
</tr>
</tbody></table>
<h2 id="5-9-元数据空间统计"><a href="#5-9-元数据空间统计" class="headerlink" title="5.9 元数据空间统计"></a>5.9 元数据空间统计</h2><p><code>jstat -gcmetacapacity &lt;pid&gt;</code></p>
<p>统计元数据空间容量</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-b99529bc7810a586ef2d23f874cc9519a9f.png" alt=""></p>
<table>
<thead>
<tr>
<th>显示列名</th>
<th>具体描述</th>
</tr>
</thead>
<tbody><tr>
<td>MCMN</td>
<td>最小元数据容量</td>
</tr>
<tr>
<td>MCMX</td>
<td>最大元数据容量</td>
</tr>
<tr>
<td>MC</td>
<td>方法区大小</td>
</tr>
<tr>
<td>CCSMN</td>
<td>最小压缩类空间大小</td>
</tr>
<tr>
<td>CCSMX</td>
<td>最大压缩类空间大小</td>
</tr>
<tr>
<td>CCSC</td>
<td>压缩类空间大小</td>
</tr>
<tr>
<td>YGC</td>
<td>从应用程序启动到采样时年轻代中gc次数</td>
</tr>
<tr>
<td>FGC</td>
<td>从应用程序启动到采样时old代(full gc)gc次数</td>
</tr>
<tr>
<td>FGCT</td>
<td>从应用程序启动到采样时old代(full gc)gc所用时间(s)</td>
</tr>
<tr>
<td>GCT</td>
<td>从应用程序启动到采样时gc用的总时间(s)</td>
</tr>
</tbody></table>
<h2 id="5-10-总结垃圾回收统计"><a href="#5-10-总结垃圾回收统计" class="headerlink" title="5.10 总结垃圾回收统计"></a>5.10 总结垃圾回收统计</h2><p><code>jstat -gcutil &lt;pid&gt;</code></p>
<p>统计gc容量占比信息</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-e9c3e67acc4d4e817d3c206512b067d181e.png" alt=""></p>
<table>
<thead>
<tr>
<th>显示列名</th>
<th>具体描述</th>
</tr>
</thead>
<tbody><tr>
<td>S0</td>
<td>年轻代中第一个survivor（幸存区）已使用的占当前容量百分比</td>
</tr>
<tr>
<td>S1</td>
<td>年轻代中第二个survivor（幸存区）已使用的占当前容量百分比</td>
</tr>
<tr>
<td>E</td>
<td>年轻代中Eden（伊甸区）已使用的占当前容量百分比</td>
</tr>
<tr>
<td>O</td>
<td>old代已使用的占当前容量百分比</td>
</tr>
<tr>
<td>P</td>
<td>perm代已使用的占当前容量百分比</td>
</tr>
<tr>
<td>YGC</td>
<td>从应用程序启动到采样时年轻代中gc次数</td>
</tr>
<tr>
<td>YGCT</td>
<td>从应用程序启动到采样时年轻代中gc所用时间(s)</td>
</tr>
<tr>
<td>FGC</td>
<td>从应用程序启动到采样时old代(full gc)gc次数</td>
</tr>
<tr>
<td>FGCT</td>
<td>从应用程序启动到采样时old代(full gc)gc所用时间(s)</td>
</tr>
<tr>
<td>GCT</td>
<td>从应用程序启动到采样时gc用的总时间(s)</td>
</tr>
</tbody></table>
<h2 id="5-11-JVM编译方法统计"><a href="#5-11-JVM编译方法统计" class="headerlink" title="5.11 JVM编译方法统计"></a>5.11 JVM编译方法统计</h2><p><code>jstat -printcompilation &lt;pid&gt;</code></p>
<p>统计 JVM编译方法的信息</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-918c3cea79f7a31ccdf12b7a0aa75eb461a.png" alt=""></p>
<table>
<thead>
<tr>
<th>显示列名</th>
<th>具体描述</th>
</tr>
</thead>
<tbody><tr>
<td>Compiled</td>
<td>最近编译方法的数量</td>
</tr>
<tr>
<td>Size</td>
<td>最近编译方法的字节码数量</td>
</tr>
<tr>
<td>Type</td>
<td>最近编译方法的编译类型。</td>
</tr>
<tr>
<td>Method</td>
<td>方法名标识</td>
</tr>
</tbody></table>
<h1 id="6-jhat-堆快照文件可视化工具"><a href="#6-jhat-堆快照文件可视化工具" class="headerlink" title="6 jhat 堆快照文件可视化工具"></a>6 jhat 堆快照文件可视化工具</h1><p>jhat（Java Virtual Machine Heap Analysis Tool）虚拟机堆转储快照分析工具，也是jdk<strong>内置</strong>的工具之一，是个用来分析java堆内存的命令，它会建立一个HTTP/HTML服务器，让用户可以在浏览器上查看分析结果，包括对象的数量，大小等等，并支持对象查询语言（OQL）。</p>
<p>jhat的作用对象是<strong>堆快照文件</strong>，也就是dump文件或者hprof文件，文件生成后，我们再使用jaht进行分析。</p>
<ol>
<li><p>使用jmap命令获取java程序堆快照（生成dump文件）</p>
</li>
<li><p>使用jconsole选项通过<code>HotSpotDiagnosticMXBean</code>从运行时获得堆快照（生成dump文件）</p>
</li>
<li><p>虚拟机启动时如果指定了<code>-XX:+HeapDumpOnOutOfMemoryError</code>选项, 则在抛出OutOfMemoryError时, 会自动执行堆快照（生成dump文件）</p>
</li>
<li><p>使用 hprof 命令获得hprof文件（生成hprof文件）</p>
</li>
</ol>
<p><strong>用法</strong>：<code>jhat [ options ] heap-dump-file</code>，如<code>jhat -J-Xmx512M app.dump</code></p>
<p>option具体选项及作用如下：</p>
<ol>
<li>-J&lt; flag &gt; 因为 jhat 命令实际上会启动一个JVM来执行, 通过 -J 可以在启动JVM时传入一些启动参数. 例如, -J-Xmx512m 则指定运行 jhat 的Java虚拟机使用的最大堆内存为 512 MB. 如果需要使用多个JVM启动参数,则传入多个 -Jxxxxxx</li>
<li>-stack false|true 关闭跟踪对象分配调用堆栈。如果分配位置信息在堆转储中不可用. 则必须将此标志设置为 false. 默认值为 true.</li>
<li>-refs false|true 关闭对象引用跟踪。默认情况下, 返回的指针是指向其他特定对象的对象,如反向链接或输入引用(referrers or incoming references), 会统计/计算堆中的所有对象。</li>
<li>-port port-number 设置 jhat HTTP server 的端口号. 默认值 7000。</li>
<li>-exclude exclude-file 指定对象查询时需要排除的数据成员列表文件。 例如, 如果文件列出了 java.lang.String.value , 那么当从某个特定对象 Object o 计算可达的对象列表时, 引用路径涉及 java.lang.String.value 的都会被排除。</li>
<li>-baseline exclude-file 指定一个基准堆转储(baseline heap dump)。 在两个 heap dumps 中有相同 object ID 的对象会被标记为不是新的(marked as not being new). 其他对象被标记为新的(new). 在比较两个不同的堆转储时很有用。</li>
<li>-debug int 设置 debug 级别. 0 表示不输出调试信息。 值越大则表示输出更详细的 debug 信息。</li>
<li>-version 启动后只显示版本信息就退出。</li>
</ol>
<blockquote>
<p>有时dump出来的堆很大，在启动时会报堆空间不足的错误，可加参数：<code>jhat -J-Xmx512m &lt;heap dump file&gt;</code>。这个内存大小可根据自己电脑进行设置。</p>
</blockquote>
<p>不过实事求是地说，在实际工作中，除非真的没有别的工具可用，否则一般不会去直接使用jhat命令来分析demp文件，主要原因有二：</p>
<ul>
<li>一是一般不会在部署应用程序的服务器上直接分析dump文件，即使可以这样做，也会尽量将dump文件拷贝到其他机器上进行分析，因为分析工作是一个耗时且消耗硬件资源的过程，既然都要在其他机器上进行，就没必要受到命令行工具的限制了；</li>
<li><strong>另外一个原因是jhat的分析功能相对来说很简陋，VisualVM以及专门分析dump文件的Eclipse Memory Analyzer、IBM HeapAnalyzer等工具</strong>，都能实现比jhat更强大更专业的分析功能。</li>
</ul>
<h2 id="6-1-jhat工具的开启"><a href="#6-1-jhat工具的开启" class="headerlink" title="6.1 jhat工具的开启"></a>6.1 jhat工具的开启</h2><ol>
<li>使用jps获取java应用的pid</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ jps</span><br><span class="line">&gt; 17904 -- process information unavailable</span><br><span class="line">&gt; 40836 Jps</span><br><span class="line">&gt; 43228 -- process information unavailable</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>使用jmap获取dump文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jmap -dump:file&#x3D;test.dump,format&#x3D;b 43228</span><br><span class="line">&gt; Dumping heap to D:\projects\i-lupro-app\test.dump ...</span><br><span class="line">&gt; Heap dump file created</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用jhat分析dump文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ jhat -J-Xmx512M test.dump</span><br><span class="line">&gt; Reading from test.dump...</span><br><span class="line">&gt; Dump file created Wed Nov 25 18:48:51 CST 2020</span><br><span class="line">&gt; Snapshot read, resolving...</span><br><span class="line">&gt; Resolving 197329 objects...</span><br><span class="line">&gt; Chasing references, expect 39 dots.......................................</span><br><span class="line">&gt; Eliminating duplicate references.......................................</span><br><span class="line">&gt; Snapshot resolved.</span><br><span class="line">&gt; Started HTTP server on port 7000</span><br><span class="line">&gt; Server is ready.</span><br></pre></td></tr></table></figure>
</li>
<li><p>在浏览器打开<code>http://localhost:7000/</code>开启可视化工具</p>
</li>
</ol>
<p><img src="https://oscimg.oschina.net/oscnet/up-6fade6dd6c5d4c22ad5bc240c8b5f9d75e5.png" alt=""></p>
<h2 id="6-2-jhat工具的功能"><a href="#6-2-jhat工具的功能" class="headerlink" title="6.2 jhat工具的功能"></a>6.2 jhat工具的功能</h2><h3 id="6-2-1-显示出堆中所包含的所有的类"><a href="#6-2-1-显示出堆中所包含的所有的类" class="headerlink" title="6.2.1 显示出堆中所包含的所有的类"></a>6.2.1 显示出堆中所包含的所有的类</h3><p><img src="https://oscimg.oschina.net/oscnet/up-c7845203fa9fcefbe17a403fada331d2fe6.png" alt=""></p>
<h3 id="6-2-2-从根集能引用到的对象"><a href="#6-2-2-从根集能引用到的对象" class="headerlink" title="6.2.2 从根集能引用到的对象"></a>6.2.2 从根集能引用到的对象</h3><p><img src="https://oscimg.oschina.net/oscnet/up-e4abad59b62e6227690f0b74c7e63636c9b.png" alt=""></p>
<h3 id="6-2-3-显示平台包括的所有类的实例数量"><a href="#6-2-3-显示平台包括的所有类的实例数量" class="headerlink" title="6.2.3 显示平台包括的所有类的实例数量"></a>6.2.3 显示平台包括的所有类的实例数量</h3><p><img src="https://oscimg.oschina.net/oscnet/up-681a652365cd626166413836fac3559e3ae.png" alt=""></p>
<h3 id="6-2-4-堆实例的分布表"><a href="#6-2-4-堆实例的分布表" class="headerlink" title="6.2.4 堆实例的分布表"></a>6.2.4 堆实例的分布表</h3><p><img src="https://oscimg.oschina.net/oscnet/up-88328e2da155165229e5fe23822dd977f76.png" alt=""></p>
<h3 id="6-2-5-执行对象查询语句（OQL）"><a href="#6-2-5-执行对象查询语句（OQL）" class="headerlink" title="6.2.5 执行对象查询语句（OQL）"></a>6.2.5 执行对象查询语句（OQL）</h3><p><img src="https://oscimg.oschina.net/oscnet/up-c37f0628b26bad0a8400a13f7b86abe91f8.png" alt=""></p>
<p>其输入内容如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查询长度大于100的字符串</span><br><span class="line">select s from java.lang.String s where s.count &gt; 100</span><br></pre></td></tr></table></figure>

<p>详细的OQL可点击上图的“OQL help”</p>
<h1 id="7-jconsole-可视化监控控制台"><a href="#7-jconsole-可视化监控控制台" class="headerlink" title="7 jconsole 可视化监控控制台"></a>7 jconsole 可视化监控控制台</h1><p>Jconsole（Java Monitoring and Management Console），一种基于JMX的可视化监视、管理工具。</p>
<h2 id="7-1-启动JConsole"><a href="#7-1-启动JConsole" class="headerlink" title="7.1 启动JConsole"></a>7.1 启动JConsole</h2><ul>
<li>点击JDK/bin 目录下面的jconsole.exe 即可启动</li>
<li>然后会自动自动搜索本机运行的所有虚拟机进程。</li>
<li>选择其中一个进程可开始进行监控</li>
</ul>
<p><img src="https://oscimg.oschina.net/oscnet/up-f5a52f0eee9f28932af48746f95e3223943.png" alt=""></p>
<h2 id="7-2-JConsole介绍"><a href="#7-2-JConsole介绍" class="headerlink" title="7.2 JConsole介绍"></a>7.2 JConsole介绍</h2><p>JConsole 基本包括以下基本功能：概述、内存、线程、类、VM概要、MBean</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-11772572f99a3f728e6ee1753fafbeea925.png" alt=""></p>
<h3 id="7-2-1-概览"><a href="#7-2-1-概览" class="headerlink" title="7.2.1 概览"></a>7.2.1 概览</h3><p><img src="https://oscimg.oschina.net/oscnet/up-7b3aa6394fca39612e1e574d824e6362663.png" alt=""></p>
<h3 id="7-2-2-内存监控"><a href="#7-2-2-内存监控" class="headerlink" title="7.2.2 内存监控"></a>7.2.2 内存监控</h3><p>内存页签相对于可视化的jstat 命令，用于监视受收集器管理的虚拟机内存。</p>
<p>jconsole可监控的内存有许多，如下图</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-acd1b73254618670e43a14991798a3afeb7.png" alt=""></p>
<p>我们以堆内存为例：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-3e498652fe610e4a921b1337f8fde118154.png" alt=""></p>
<table>
<thead>
<tr>
<th>选项</th>
<th>值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>堆内存的大小</td>
<td>442032KB</td>
<td></td>
</tr>
<tr>
<td>已使用</td>
<td>249362KB</td>
<td>目前使用的内存量，包括所有对象，可达和不可达占用的内存。</td>
</tr>
<tr>
<td>已提交</td>
<td>442032KB</td>
<td>保证由Java虚拟机使用的内存量。 提交的内存量可能会随时间而改变。 Java虚拟机可能会释放系统内存，并已提交的内存量可能会少于最初启动时分配的内存量。 提交的内存量将始终大于或等于使用的内存量。</td>
</tr>
<tr>
<td>最大值</td>
<td>742400KB</td>
<td>可用于内存管理的最大内存量。 它的价值可能会发生变化，或者是不确定的。 如果Java虚拟机试图增加使用的内存要大于提交的内存，内存分配可能失败，即使使用量小于或等于最大值（例如，当系统上的虚拟内存不足）。</td>
</tr>
<tr>
<td>GC时间</td>
<td>parnew上的 3.487s(73收集)</td>
<td>累计时间花在垃圾收集和调用的总数。 它可能有多个行，其中每一个代表一个垃圾收集器算法在Java虚拟机的总耗时和执行次数</td>
</tr>
<tr>
<td>堆</td>
<td>–</td>
<td>堆内存是运行时数据区域，Java VM的所有类实例和数组分配内存。 可能是固定或可变大小的堆。</td>
</tr>
<tr>
<td>非堆内存</td>
<td>–</td>
<td>非堆内存包括在所有线程和Java虚拟机内部处理或优化所需的共享的方法。 它存储了类的结构，运行常量池，字段和方法数据，以及方法和构造函数的代码，方法区在逻辑上是堆的一部分，看具体实现的方式。根据实现方式的不同，Java虚拟机可能不进行垃圾收集或压缩。 堆内存一样，方法区域可能是一个固定或可变大小。 方法区的内存不需要是连续的。</td>
</tr>
</tbody></table>
<blockquote>
<p>除了方法区，Java虚拟机可能需要进行内部处理或优化，这也属于非堆内存的内存。 例如，实时（JIT）编译器需要内存用于存储从Java虚拟机的高性能的代码翻译的机器码。</p>
</blockquote>
<h3 id="7-2-3-线程监控"><a href="#7-2-3-线程监控" class="headerlink" title="7.2.3 线程监控"></a>7.2.3 线程监控</h3><p>如果上面的“内存”页签相当于可视化的jstat命令的话，<strong>“线程”页签的功能相当于可视化的jstack命令</strong>，遇到线程停顿时可以使用这个页签进行监控分析。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-11dd1568537efa5bfb71e6327e5cd100ab4.png" alt=""></p>
<p>在左下角的“线程”列表列出了所有的活动线程。 如果你输入一个“filter”字段中的字符串，线程列表将只显示其名称中包含你输入字符串线程。 点击一个线程在线程列表的名称，显示该线程的信息的权利，包括线程的名称，状态、阻塞和等待的次数、堆栈跟踪。</p>
<p>如果要检查您的应用程序已经陷入死锁的线程，可以通过点击“检测死锁”按钮检测。线程长时间停顿的主要原因主要有：等待外部资源（数据库连接、网络资源、设备资源等）、死循环、锁等待（活锁和死锁）</p>
<p>我们写个死锁代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.jvm;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * 线程死锁验证</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class JConsoleThreadLock &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 线程死锁等待演示</span><br><span class="line">     *&#x2F;</span><br><span class="line">    static class SynAddRunalbe implements Runnable &#123;</span><br><span class="line">        int a, b;</span><br><span class="line">        public SynAddRunalbe(int a, int b) &#123;</span><br><span class="line">            this.a &#x3D; a;</span><br><span class="line">            this.b &#x3D; b;</span><br><span class="line">        &#125;</span><br><span class="line">        @Override</span><br><span class="line">        public void run() &#123;</span><br><span class="line">            synchronized (Integer.valueOf(a)) &#123;</span><br><span class="line">                synchronized (Integer.valueOf(b)) &#123;</span><br><span class="line">                    System.out.println(a + b);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 100; i++) &#123;</span><br><span class="line">            new Thread(new SynAddRunalbe(1, 2)).start();</span><br><span class="line">            new Thread(new SynAddRunalbe(2, 1)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这段代码开了200个线程去分别计算1+2以及2+1的值，其实for循环是可省略的，两个线程也可能会导致死锁，不过那样概率太小，需要尝试运行很多次才能看到效果。一般的话，带for循环的版本最多运行2～3次就会遇到线程死锁，程序无法结束。</p>
</blockquote>
<blockquote>
<p>造成死锁的原因是Integer.valueOf（）方法基于减少对象创建次数和节省内存的考虑，<code>[-128，127]</code>之间的数字会被缓存，当valueOf（）方法传入参数在这个范围之内，将直接返回缓存中的对象。也就是说，代码中调用了200次Integer.valueOf（）方法一共就只返回了两个不同的对象。假如在某个线程的两个synchronized块之间发生了一次线程切换，那就会出现线程A等着被线程B持有的Integer.valueOf（1），线程B又等着被线程A持有的Integer.valueOf（2），结果出现大家都<br>跑不下去的情景。</p>
</blockquote>
<p>如果检测到任何死锁的线程，这些都显示在一个新的标签，旁边出现的“死锁”标签， 在图所示。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-1832aa910902ad945d0f4c6e7c009541567.png" alt=""></p>
<p>结果描述：显示了线程Thread-53在等待一个被线程Thread-66持有Integer对象，而点击线程Thread-66则显示它也在等待一个Integer对象，被线程Thread-53持有，这样两个线程就互相卡住，都不存在等到锁释放的希望了</p>
<h3 id="7-2-4-类加载信息监控"><a href="#7-2-4-类加载信息监控" class="headerlink" title="7.2.4 类加载信息监控"></a>7.2.4 类加载信息监控</h3><p>类”标签显示关于类加载的信息。</p>
<ul>
<li>红线表示加载的类的总数（包括后来卸载的）</li>
<li>蓝线是当前的类加载数</li>
</ul>
<p><img src="https://oscimg.oschina.net/oscnet/up-6ee2e744430067f37f21fc733ed06c0d888.png" alt=""></p>
<p>在选项卡底部的详细信息部分显示类的加载，因为Java虚拟机开始的总数，当前加载和卸载的数量。** 跟踪**类加载详细的输出，您可以勾选在顶部的右上角复选框。</p>
<h3 id="7-2-5-VM概要监控"><a href="#7-2-5-VM概要监控" class="headerlink" title="7.2.5 VM概要监控"></a>7.2.5 VM概要监控</h3><p><img src="https://oscimg.oschina.net/oscnet/up-a46f88dfc8f4816f0c090b24eaa5aaef8d5.png" alt=""></p>
<p>在此选项卡中提供的信息包括以下内容。</p>
<ul>
<li>摘要<ul>
<li>运行时间 ：开始以来，Java虚拟机的时间总额。</li>
<li>进程的CPU时间 ：Java VM的开始，因为它消耗的CPU时间总量。</li>
<li>编译总时间 ：累计时间花费在JIT编译。</li>
</ul>
</li>
<li>主题<ul>
<li>活动线程 ：目前现场守护线程，加上非守护线程数量。</li>
<li>峰值 ：活动线程的最高数目，因为Java虚拟机开始。</li>
<li>守护线程 ：当前的活动守护线程数量。</li>
<li>总线程 ：开始自Java虚拟机启动的线程总数，包括非守护进程，守护进程和终止的线程。</li>
</ul>
</li>
<li>类<ul>
<li>当前类装载 ：目前加载到内存中的类数目。</li>
<li>总类加载 ：从Java VM开始加载到内存中的类总和，包括那些后来被卸载的类。</li>
<li>已卸载类总数 ：从Java虚拟机开始从内存中卸载的类的数目。</li>
</ul>
</li>
<li>内存<ul>
<li>当前的堆大小 ：目前所占用的堆的千字节数。</li>
<li>分配的内存 ：堆分配的内存总量。</li>
<li>最大堆最大值 ：堆所占用的千字节的最大数目。</li>
<li>待最后确定的对象：待最后确定的对象的数量。</li>
<li>花在执行GC的垃圾收集器 ：包括垃圾收集，垃圾收集器的名称，进行藏品的数量和总时间的信息。</li>
</ul>
</li>
<li>操作系统<ul>
<li>总物理内存</li>
<li>空闲物理内存</li>
<li>分配的虚拟内存</li>
<li>其他信息</li>
</ul>
</li>
<li>VM参数 ：输入参数的应用程序通过Java虚拟机，不包括的主要方法的参数。<ul>
<li>类路径是由系统类加载器用于搜索类文件的类路径。</li>
<li>库路径 ：加载库时要搜索的路径列表。</li>
<li>引导类路径 ：引导类路径是由引导类加载器用于搜索类文件。</li>
</ul>
</li>
</ul>
<h1 id="8-jvisualvm"><a href="#8-jvisualvm" class="headerlink" title="8 jvisualvm"></a>8 jvisualvm</h1><p>jvisualvm是Netbeans的profile子项目，从JDK6.0 update 7 版本开始自带。jvisualvm同jconsole一样，都是一个基于图形化界面的、可以查看本地及远程的JAVA GUI监控工具，jvisualvm是一个综合性的分析工具，其整合了jstack、jmap、jinfo等众多调试工具的功能，<strong>可以认为jvisualvm是jconsole的升级版</strong>。</p>
<h2 id="8-1-启动jvisualvm"><a href="#8-1-启动jvisualvm" class="headerlink" title="8.1 启动jvisualvm"></a>8.1 启动jvisualvm</h2><p>在<strong>JDK_HOME/bin下双击jvisualvm.exe</strong>，或者<strong>直接在命令行中输入<code>jvisualvm</code></strong> 都可</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-dbb2e524e7ef676a8b13536be297b1a1005.png" alt=""></p>
<p><img src="https://oscimg.oschina.net/oscnet/up-92d0c7e5219ec32ed45379a2fdea9f78785.png" alt=""></p>
<p>我们可以看到侧边框：</p>
<ul>
<li>本地：如果你本地有java进程启动了，那么在本地这个栏目就会显示。</li>
<li>远程：监控的远程主机</li>
<li>快照：装载dump文件或者hprof文件，进行分析</li>
</ul>
<blockquote>
<p>由于本地和远程展示的监控界面都是相同的，接下来我们直接介绍远程。</p>
</blockquote>
<h2 id="8-2-添加远程监控"><a href="#8-2-添加远程监控" class="headerlink" title="8.2 添加远程监控"></a>8.2 添加远程监控</h2><p>注意，一个主机如果希望支持远程监控，需要在启动时添加以下参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-Dcom.sun.management.jmxremote.port&#x3D;1099</span><br><span class="line">-Dcom.sun.management.jmxremote.authenticate&#x3D;false</span><br><span class="line">-Dcom.sun.management.jmxremote.ssl&#x3D;false</span><br></pre></td></tr></table></figure>

<p>右击”远程”–&gt;”添加远程主机”，出现界面：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-25b65255824dc5691a94fa27cda8c66b382.png" alt=""></p>
<p>在连接后面添加一个1099，这是远程主机jmx监听的端口号，点击确定，侧边栏变为：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-22396788168496d5121b6acc394d3dbd1af.png" alt=""></p>
<p>点击红色框中的jmx连接，出现以下界面：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-3552febc4e82aeb6dbd832dcaa723024e54.png" alt=""></p>
<h2 id="8-3-jvisualvm介绍"><a href="#8-3-jvisualvm介绍" class="headerlink" title="8.3 jvisualvm介绍"></a>8.3 jvisualvm介绍</h2><p>jvisualvm分为四个选项卡：概述、监视、线程、抽样器，下面我们一一介绍：</p>
<h3 id="8-3-1-概述页"><a href="#8-3-1-概述页" class="headerlink" title="8.3.1 概述页"></a>8.3.1 概述页</h3><p>默认显示的就是概述选项卡，其中的信息相当于我们调用了jinfo命令获得，其还包含了两个子选项卡：</p>
<ul>
<li>jvm参数栏：相当于我们调用<code>jinfo -flags &lt;pid&gt;</code>获得</li>
<li>系统属性栏：相当于我们调用<code>jinfo -sysprops &lt;pid&gt;</code>获得</li>
</ul>
<p><img src="https://oscimg.oschina.net/oscnet/up-ffed656702f8fe2641cb4bb7ae83281b0ee.png" alt=""></p>
<h3 id="8-3-2-监视页"><a href="#8-3-2-监视页" class="headerlink" title="8.3.2 监视页"></a>8.3.2 监视页</h3><p>主要显示了cpu、内存使用、类加载信息、线程信息等，这只是一个概要性的介绍，如下图：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-e38d18357d6c96ae69b4b9c25766b459c8b.png" alt=""></p>
<p>点击右上角的”堆dump”会在远程主机上，dump一个内存映射文件，之所以不直接dump到本地，主要是因为这个文件通常比较大，直接dump到本地会很慢。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-7d9ad6266394309df4e9343655b7f1f6edd.png" alt=""></p>
<p>dump完成之后，可以手工下载这个文件，通过”文件”-&gt;”装入”来进行分析。</p>
<h3 id="8-3-3-线程页"><a href="#8-3-3-线程页" class="headerlink" title="8.3.3 线程页"></a>8.3.3 线程页</h3><p><img src="https://oscimg.oschina.net/oscnet/up-718039e69ea0ad56e389bb512a81ff7ac48.png" alt=""></p>
<p>线程选项卡列出了所有线程的信息，并使用了不同的颜色标记，右下角的颜色表示了不同的状态。</p>
<p>右上角的线程dump会直接把线程信息dump到本地，相当于调用了jstack命令，如：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-03f1bfbcedf2a842dd3d0cb790b8d1287c6.png" alt=""></p>
<h3 id="8-3-4-抽样器页"><a href="#8-3-4-抽样器页" class="headerlink" title="8.3.4 抽样器页"></a>8.3.4 抽样器页</h3><p><img src="https://oscimg.oschina.net/oscnet/up-8aa58a8dfaae014e7527a2014c165f8258c.png" alt=""></p>
<p>主要有”cpu”和”内存”两个按钮，功能类似，只不过一个是抽样线程占用cpu的情况，一个是抽样jvm对象内存的情况。</p>
<ol>
<li>通过设置可以对CPU的采样来源以及内存的刷新时间进行设置；</li>
<li>点击CPU或者Memory即可开始监控，点击Stop则停止采样；</li>
</ol>
<p>我们以分析cpu波动为例，看下如何使用cpu采样器：</p>
<h4 id="8-3-4-1-分析CPU波动问题"><a href="#8-3-4-1-分析CPU波动问题" class="headerlink" title="8.3.4.1 分析CPU波动问题"></a>8.3.4.1 分析CPU波动问题</h4><p>进入抽样器页（Sampler），在CPU波动的时候点击CPU对CPU进行抽样。</p>
<blockquote>
<p>注意线上环境千万不要使用Sampler右边的Profiler</p>
</blockquote>
<p><img src="https://oscimg.oschina.net/oscnet/up-80ed68d547848d4668aab24f61e7f44d698.png" alt=""></p>
<p>抽样进行一段时间后(建议3分钟左右就行了,时间越长生成的snapshot越大)，点击”stop”，然后点击”snapshot”生成快照</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-69e8bee44a52630014339ec455772acf110.png" alt=""></p>
<p>生成快照后按照”Total Time(CPU)”排序，找到那些线程最耗费CPU，从下图中我们看到基本上都是DubboServerHandler，熟悉Dubbo框架的知道这都是我们的业务线程。</p>
<p>那么我们对这些线程进行分析(多分析几个线程，双击指定线程就可以看这个线程的调用栈以及耗时情况)，看看这些线程在哪里比较耗费CPU。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-0a126964b1c68919ee1de1a4336be7e0aeb.png" alt=""></p>
<p>通过分析发现，在Dubbo远程调用的时候验证参数的时间比我们处理业务的时间都长(见下图红色方框框起来的方法)。结合Dubbo官方文档得知，Dubbo的参数验证这个特性是比较耗费性能的，而我们的接口参数使用了javax.validation注解来验证参数。所以我们在调用的时候使用validation=”false”禁止使用参数验证这个特性就好了CPU就回归正常了。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-e1185e4e6d8c2f03b51ebe8c0cc12795d79.png" alt=""></p>
<p>除此之外，我们也可以动态的观察线程的变化，功能有点类似JProfiler的“Mark Current Values”。我们点击<code>线程CPU时间</code>这个tab。查看每个线程占用cpu时间的增量数据。</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-d8aa6364c24d1ee6a5d54dca88e268b49e7.png" alt=""></p>
<h4 id="8-3-4-2-内存采样"><a href="#8-3-4-2-内存采样" class="headerlink" title="8.3.4.2 内存采样"></a>8.3.4.2 内存采样</h4><p>和cpu采样一样的，样进行一段时间后(建议3分钟左右就行了,时间越长生成的snapshot越大)，点击”stop”，然后点击”snapshot”生成快照</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-66d559639df230c6c48a70f8bd475f43d63.png" alt=""></p>
<p>点击增量同样可以监控内存的变动情况：</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-d1b4d0a420cce0835ec4eb2ad4ba03af88d.png" alt=""></p>
<p>点击“执行GC”，则可以手动触发GC；<br>点击“堆Dump”，则可以手动触发dump文件生成；</p>
<p><img src="https://oscimg.oschina.net/oscnet/up-5e0e8b3c2b4d94ca3a6b660f1defcec55d5.png" alt=""></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JAVA/" rel="tag"># JAVA</a>
          
            <a href="/tags/JVM/" rel="tag"># JVM</a>
          
            <a href="/tags/Thread/" rel="tag"># Thread</a>
          
            <a href="/tags/gc/" rel="tag"># gc</a>
          
            <a href="/tags/Heap/" rel="tag"># Heap</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/11/24/%E7%AE%80%E8%BF%B0%E4%BA%8C%E5%8F%89%E5%A0%86%E5%92%8C%E4%BC%98%E5%85%88%E7%BA%A7%E9%98%9F%E5%88%97/" rel="next" title="简述二叉堆和优先级队列">
                <i class="fa fa-chevron-left"></i> 简述二叉堆和优先级队列
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div class="ds-thread" data-thread-key="2020/12/02/JAVA监控和调优工具操作指南（此坑未填）/"
           data-title="JAVA监控和调优工具操作指南" data-url="http://yoursite.com/2020/12/02/JAVA%E7%9B%91%E6%8E%A7%E5%92%8C%E8%B0%83%E4%BC%98%E5%B7%A5%E5%85%B7%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97%EF%BC%88%E6%AD%A4%E5%9D%91%E6%9C%AA%E5%A1%AB%EF%BC%89/">
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://oscimg.oschina.net/oscnet/up-c01f8b7b68770ed58c420d68072f773a30b.png"
                alt="cherish-ls" />
            
              <p class="site-author-name" itemprop="name">cherish-ls</p>
              <p class="site-description motion-element" itemprop="description">纸上得来终觉浅</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">55</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">96</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="git@github.com:cherish-ls/cherish-ls.github.io.git" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-text">前言</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#进程id的获取"><span class="nav-text">进程id的获取</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jinfo-jmap访问受限的解决"><span class="nav-text">jinfo&#x2F;jmap访问受限的解决</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-jps-显示JVM进程信息"><span class="nav-text">1 jps 显示JVM进程信息</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-jps的选项"><span class="nav-text">1.1 jps的选项</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-jinfo-显示JVM配置信息"><span class="nav-text">2 jinfo 显示JVM配置信息</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-输出JVM进程的参数和属性"><span class="nav-text">2.1 输出JVM进程的参数和属性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-打印JVM特定参数的值"><span class="nav-text">2.2 打印JVM特定参数的值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-开启或关闭JVM特定参数"><span class="nav-text">2.3 开启或关闭JVM特定参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-设置JVM特定参数的值"><span class="nav-text">2.4 设置JVM特定参数的值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-5-打印所有JVM参数"><span class="nav-text">2.5 打印所有JVM参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-6-打印所有系统参数"><span class="nav-text">2.6 打印所有系统参数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-jmap-生成内存快照文件"><span class="nav-text">3 jmap 生成内存快照文件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-输出hprof二进制格式的heap文件"><span class="nav-text">3.1 输出hprof二进制格式的heap文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-打印正等候回收的对象的信息"><span class="nav-text">3.2 打印正等候回收的对象的信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-打印heap的概要信息"><span class="nav-text">3.3 打印heap的概要信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-4-打印每个class的实例信息"><span class="nav-text">3.4 打印每个class的实例信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-5-打印类加载器的数据"><span class="nav-text">3.5 打印类加载器的数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-6-指定传递给运行jmap的JVM的参数"><span class="nav-text">3.6 指定传递给运行jmap的JVM的参数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-jstack-输出线程堆栈快照"><span class="nav-text">4 jstack 输出线程堆栈快照</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-程序没有响应时强制打印线程"><span class="nav-text">4.1 程序没有响应时强制打印线程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-打印完整的堆栈信息"><span class="nav-text">4.2 打印完整的堆栈信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-打印java-native框架的所有堆栈"><span class="nav-text">4.3 打印java&#x2F;native框架的所有堆栈</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-4-jstack统计线程数"><span class="nav-text">4.4 jstack统计线程数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-5-jstack检测死锁"><span class="nav-text">4.5 jstack检测死锁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-6-jstack检测cpu高"><span class="nav-text">4.6 jstack检测cpu高</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-jstat-收集JVM运行数据"><span class="nav-text">5 jstat 收集JVM运行数据</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-类加载统计"><span class="nav-text">5.1 类加载统计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-编译统计"><span class="nav-text">5.2 编译统计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-垃圾回收统计"><span class="nav-text">5.3 垃圾回收统计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-堆内存统计"><span class="nav-text">5.4 堆内存统计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-5-新生代垃圾回收统计"><span class="nav-text">5.5 新生代垃圾回收统计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-6-新生代内存统计"><span class="nav-text">5.6 新生代内存统计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-7-老年代垃圾回收统计"><span class="nav-text">5.7 老年代垃圾回收统计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-8-老年代内存统计"><span class="nav-text">5.8 老年代内存统计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-9-元数据空间统计"><span class="nav-text">5.9 元数据空间统计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-10-总结垃圾回收统计"><span class="nav-text">5.10 总结垃圾回收统计</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-11-JVM编译方法统计"><span class="nav-text">5.11 JVM编译方法统计</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-jhat-堆快照文件可视化工具"><span class="nav-text">6 jhat 堆快照文件可视化工具</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-jhat工具的开启"><span class="nav-text">6.1 jhat工具的开启</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-jhat工具的功能"><span class="nav-text">6.2 jhat工具的功能</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-1-显示出堆中所包含的所有的类"><span class="nav-text">6.2.1 显示出堆中所包含的所有的类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-2-从根集能引用到的对象"><span class="nav-text">6.2.2 从根集能引用到的对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-3-显示平台包括的所有类的实例数量"><span class="nav-text">6.2.3 显示平台包括的所有类的实例数量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-4-堆实例的分布表"><span class="nav-text">6.2.4 堆实例的分布表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-5-执行对象查询语句（OQL）"><span class="nav-text">6.2.5 执行对象查询语句（OQL）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-jconsole-可视化监控控制台"><span class="nav-text">7 jconsole 可视化监控控制台</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-启动JConsole"><span class="nav-text">7.1 启动JConsole</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-JConsole介绍"><span class="nav-text">7.2 JConsole介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-1-概览"><span class="nav-text">7.2.1 概览</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-2-内存监控"><span class="nav-text">7.2.2 内存监控</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-3-线程监控"><span class="nav-text">7.2.3 线程监控</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-4-类加载信息监控"><span class="nav-text">7.2.4 类加载信息监控</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-5-VM概要监控"><span class="nav-text">7.2.5 VM概要监控</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-jvisualvm"><span class="nav-text">8 jvisualvm</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-启动jvisualvm"><span class="nav-text">8.1 启动jvisualvm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-添加远程监控"><span class="nav-text">8.2 添加远程监控</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-jvisualvm介绍"><span class="nav-text">8.3 jvisualvm介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-1-概述页"><span class="nav-text">8.3.1 概述页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-2-监视页"><span class="nav-text">8.3.2 监视页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-3-线程页"><span class="nav-text">8.3.3 线程页</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-4-抽样器页"><span class="nav-text">8.3.4 抽样器页</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-4-1-分析CPU波动问题"><span class="nav-text">8.3.4.1 分析CPU波动问题</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-4-2-内存采样"><span class="nav-text">8.3.4.2 内存采样</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cherish-ls</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">385.7k</span>
  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 访问总量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"cherish"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  
















  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: true,
        appId: 'TQhjcmooFXWGQ3qgqUroDKsD-gzGzoHsz',
        appKey: 'zjA9PvG5eljY1JErig8WVQQD',
        placeholder: 'ヾﾉ≧∀≦)o来啊，快活啊!',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

</body>
</html>
